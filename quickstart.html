

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart &mdash; adfluo 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User Guide" href="user_guide.html" />
    <link rel="prev" title="Welcome to adfluo’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> adfluo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-dataset">Setting up a Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-pipelines">Setting up pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-extraction-and-saving-the-features">Running the extraction and saving the features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_tos.html">How-To</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">adfluo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<span id="id1"></span><h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-a-dataset">
<h2>Setting up a Dataset<a class="headerlink" href="#setting-up-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>Let’s say that we had the following yaml file describing some data that we had for
a bunch of samples (only 4 here for the sake of simplicity).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SAMPLE-001</span>
<span class="linenos"> 2</span>  <span class="nt">audio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">audio/data/sample1.wav</span>
<span class="linenos"> 3</span>  <span class="nt">text</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I will taunt you a second time!</span>
<span class="linenos"> 4</span>  <span class="nt">speech</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.2232</span>
<span class="linenos"> 6</span>      <span class="nt">end</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4.3976</span>
<span class="linenos"> 7</span><span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SAMPLE-002</span>
<span class="linenos"> 8</span><span class=" -Error"> </span><span class="nt">audio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">audio/data/sample2.wav</span>
<span class="linenos"> 9</span>  <span class="l l-Scalar l-Scalar-Plain">text</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">You mother was a hamster and your father smelt of elderberries!</span>
<span class="linenos">10</span>  <span class="l l-Scalar l-Scalar-Plain">speech</span><span class="p p-Indicator">:</span>
<span class="linenos">11</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.343</span>
<span class="linenos">12</span>      <span class="nt">end</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5.8232</span>
<span class="linenos">13</span><span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SAMPLE-003</span>
<span class="linenos">14</span>  <span class="nt">audio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">audio/data/sample3.wav</span>
<span class="linenos">15</span>  <span class="nt">text</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I ain&#39;t happy, I&#39;m feeling glad, I got sunshine in a bag, I&#39;m useless but not for long, the future is coming on</span>
<span class="linenos">16</span>  <span class="nt">speech</span><span class="p">:</span>
<span class="linenos">17</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1543</span>
<span class="linenos">18</span>      <span class="nt">end</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.032</span>
<span class="linenos">19</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.7</span>
<span class="linenos">20</span>      <span class="nt">end</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5.632</span>
<span class="linenos">21</span><span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SAMPLE-004</span>
<span class="linenos">22</span>  <span class="nt">audio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">audio/data/sample4.wav</span>
<span class="linenos">23</span>  <span class="nt">text</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">That&#39;s one small step for man, one giant leap for mankind.</span>
<span class="linenos">24</span>  <span class="nt">speech</span><span class="p">:</span>
<span class="linenos">25</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.2508</span>
<span class="linenos">26</span>      <span class="nt">end</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.032</span>
<span class="linenos">27</span>    <span class="p p-Indicator">-</span> <span class="nt">start</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.4</span>
<span class="linenos">28</span>        <span class="l l-Scalar l-Scalar-Plain">end</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6.1209</span>
</pre></div>
</div>
<p>Each sample therefore has:</p>
<ul class="simple">
<li><p>a unique identifier (<code class="docutils literal notranslate"><span class="pre">id</span></code>)</p></li>
<li><p>a corresponding audio recording pointed by a path (<code class="docutils literal notranslate"><span class="pre">audio</span></code>)</p></li>
<li><p>a transcription of that recording (<code class="docutils literal notranslate"><span class="pre">text</span></code>)</p></li>
<li><p>one or more audio intervals (bounded by <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code>)
that describe when the speaker is talking.</p></li>
</ul>
<p>Let’s create a sample class whose instances correspond to entries of this
<code class="docutils literal notranslate"><span class="pre">yaml</span></code> file. This class should provide <cite>afluo</cite> with to methods:</p>
<ul class="simple">
<li><p>an <code class="docutils literal notranslate"><span class="pre">id</span></code> property that returns a unique id for that sample (in our case, easy thing!)</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">get_data</span></code> method that should provide, for an instance of a sample, some
data corresponding to the requested <code class="docutils literal notranslate"><span class="pre">data_name</span></code>. Note that the chosen <code class="docutils literal notranslate"><span class="pre">data_name</span></code>
values are purely arbitrary, and up to your own choice in practice.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adfluo</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="c1"># used for loading audio</span>

<span class="k">class</span> <span class="nc">MySample</span><span class="p">(</span><span class="n">Sample</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># has to be overriden, and must be unique (per sample)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># returns the right data for a given input name</span>
        <span class="k">if</span> <span class="n">data_name</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">data_name</span> <span class="o">==</span> <span class="s2">&quot;speech&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">interval</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">interval</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;speech&quot;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">data_name</span> <span class="o">==</span> <span class="s2">&quot;audio_array&quot;</span><span class="p">:</span>
            <span class="n">audio_array</span><span class="p">,</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wave</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="n">audio_array</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">rate</span><span class="p">}</span>
</pre></div>
</div>
<p>Now that we’ve implemented the sample class, let’s implement the <code class="docutils literal notranslate"><span class="pre">DatasetLoader</span></code> class. It should
return an iterable of samples, and be able to tell <cite>adfluo</cite> how many samples there are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adfluo</span> <span class="kn">import</span> <span class="n">DatasetLoader</span>
<span class="kn">import</span> <span class="nn">yaml</span> <span class="c1"># use to load the yaml data</span>

<span class="k">class</span> <span class="nc">MyDataset</span><span class="p">(</span><span class="n">DatasetLoader</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">yml_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># has to be overriden</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># has to be overriden</span>
        <span class="c1"># notice that we&#39;re lazily loading samples.</span>
        <span class="c1"># This could be useful when samples are too big for your memory to be loaded all at once!</span>
        <span class="k">for</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">MySample</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sample_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we’ve set up what’s needed to load your data, let’s proceed to the interesting part: the
feature extraction pipelines.</p>
</div>
<div class="section" id="setting-up-pipelines">
<h2>Setting up pipelines<a class="headerlink" href="#setting-up-pipelines" title="Permalink to this headline">¶</a></h2>
<p>For each sample of our dataset, and for some unknown yet strangely didactic reason,
we’d like to compute the following features <strong>for each sample in our dataset</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>the number of words</p></li>
<li><p>the number of verbs</p></li>
<li><p>the number of nouns</p></li>
<li><p>the audio length (in seconds)</p></li>
<li><p>the audio average energy</p></li>
<li><p>the (spoken time / total audio time) ratio</p></li>
<li><p>the number of nouns per spoken second</p></li>
</ul>
</div></blockquote>
<p>To compute features, we’ll need to build <strong>feature extraction pipelines</strong>, and
to build pipelines, we’ll need <strong>processors</strong>. Processors can be functions or
a special type of class from <cite>adfluo</cite> that you’ll need to inherit from.</p>
<p>Let’s start with the first pipelines: words, verbs and nouns. Let’s build 3
processors: one to split the text into a list of words, one to do part of speech
tagging, and one to count words.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adfluo</span> <span class="kn">import</span> <span class="n">SampleProcessor</span>

<span class="k">def</span> <span class="nf">split_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; ,.?!;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PartofSpeech</span><span class="p">(</span><span class="n">SampleProcessor</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">word_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">word_type</span><span class="o">=</span><span class="n">word_type</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">word_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="s2">&quot;noun&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">word_type</span> <span class="o">=</span> <span class="n">word_type</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">word_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># here, through some magic (for instance using spacy),</span>
        <span class="c1"># either only the nouns or verbs are  returned</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">count_words</span><span class="p">(</span><span class="n">word_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, let’s create an extractor, and register the feature extraction pipelines
to it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adfluo</span> <span class="kn">import</span> <span class="n">Extractor</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Feat</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="n">Extractor</span><span class="p">()</span>
<span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">split_text</span> <span class="o">&gt;&gt;</span> <span class="n">count_words</span> <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;word_count&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">split_text</span> <span class="o">&gt;&gt;</span> <span class="n">PartOfSpeech</span><span class="p">(</span><span class="s2">&quot;verb&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">count_words</span> <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;verbs_count&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">split_text</span> <span class="o">&gt;&gt;</span> <span class="n">PartOfSpeech</span><span class="p">(</span><span class="s2">&quot;noun&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">count_words</span> <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;nouns_count&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now let’s proceed to audio processors used to compute the audio duration, spoken time ratio, and average energy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">audio_duration</span><span class="p">(</span><span class="n">audio_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_data</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">audio_data</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">spoken_time</span><span class="p">(</span><span class="n">intervals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">average_energy</span><span class="p">(</span><span class="n">audio_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">audio_data</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_data</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Now, we can create the pipelines, still using the extractor we’ve created earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;audio_array&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">audio_duration</span> <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;audio_duration&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;audio_array&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">average_energy</span> <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;avg_energy&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
     <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;speech&quot;</span><span class="p">)</span>
     <span class="o">&gt;&gt;</span> <span class="n">T</span><span class="p">(</span><span class="n">spoken_time</span><span class="p">,</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;audio_duration&quot;</span><span class="p">))</span>
     <span class="o">&gt;&gt;</span> <span class="k">lambda</span> <span class="n">dur_spoken</span><span class="p">,</span> <span class="n">dur_audio</span> <span class="p">:</span> <span class="n">dur_spoken</span><span class="o">/</span> <span class="n">dur_audio</span>
     <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;spoken_ratio&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that we used a lambda to avoid having to create yet another function
just compute a division. We’ll now finish with the number of nouns per spoken seconds,
which won’t require any new processor (we’ll be using a lambda again):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extractor</span><span class="o">.</span><span class="n">add_extraction</span><span class="p">(</span>
        <span class="n">T</span><span class="p">(</span><span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;nouns_count&quot;</span><span class="p">),</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;spoken_duration&quot;</span><span class="p">))</span>
         <span class="o">&gt;&gt;</span> <span class="k">lambda</span> <span class="n">nb_nouns</span><span class="p">,</span> <span class="n">dur_spoken</span> <span class="p">:</span> <span class="n">nb_nouns</span><span class="o">/</span> <span class="n">dur_audio</span>
         <span class="o">&gt;&gt;</span> <span class="n">Feat</span><span class="p">(</span><span class="s2">&quot;nouns_per_seconds&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-extraction-and-saving-the-features">
<h2>Running the extraction and saving the features<a class="headerlink" href="#running-the-extraction-and-saving-the-features" title="Permalink to this headline">¶</a></h2>
<p>Now that our data is properly loaded and the extraction pipeline defined,
we can run the extraction and save the computed features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can either extract to csv</span>
<span class="n">extractor</span><span class="o">.</span><span class="n">extract_to_csv</span><span class="p">(</span><span class="s2">&quot;path/to/feature/file.csv&quot;</span><span class="p">)</span>

<span class="c1"># or to a pickle file</span>
<span class="n">extractor</span><span class="o">.</span><span class="n">extract_to_pickle</span><span class="p">(</span><span class="s2">&quot;path/to/feature/file.pckl&quot;</span><span class="p">)</span>

<span class="c1"># or to a dict</span>
<span class="n">feat_dict</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_to_dict</span><span class="p">()</span>

<span class="c1"># or to a pandas dataframe</span>
<span class="n">feat_df</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_to_df</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="user_guide.html" class="btn btn-neutral float-right" title="User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to adfluo’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Hadrien Titeux.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>